<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<html>
 <head>
       <meta charset="utf-8">
         <title>BibOut: Creating Templates</title>
         <link rel="stylesheet" href="stylesheets/bootstrap.min.css">
         <link rel="stylesheet" href="stylesheets/stylesheet.css">
 </head>
 <body>
         
 <div class="container">
         
        
 <div class="row">
    <div class="span8">
       <h1>How to Create Templates</h1>

      <h2>Overview</h2>
<p>
      Templates are simply ERB files that have a few special variables and functions in their
      environment. If you're not familiar with Ruby, ERB is a library that allows
      you to embed Ruby code in arbitrary text files. A template is simply a regular
      text file where:
</p>
      
      <ul>
	<li>Any text within <code>&lt;% %&gt;</code> is evaluated as Ruby code</li>	
	<li>Any text within <code>&lt;%= %&gt;</code> is evaluated as Ruby code,
	<em>and the result is included in the output</em></li>
      </ul>

      <p>
      Template files are literally passed to ERB unchanged, so anything that
      is legal in ERB is OK in a template file.
      </p>
      <p>
      Here is a simple example of a template file. This template will output
      the year, authors, and title of every paper in the bibliography,
      embedded within an HTML ordered list.
      The entries will be sorted by year.
      <pre>&lt;ol>
  &lt;% bib.sort_by { |e| e.year }.reverse.each do |entry| %>
      &lt;li>&lt;%= entry.year %>. &lt;%= entry.author.pretty %>. &lt;%= entry.title %>&lt;/li>
  &lt;% end %>
&lt;/ol>
</pre>

      <p>
      Notice how the <code>end</code> in the fourth line closes the <code>do</code> two lines above.
The variable <code>bib</code> as well as the functions <code>year, author, pretty,</code> and
<code>title</code> are all provided by BibOut, and are described in the next section.
      </p>

      <h2>Special functions available to BibOut templates</h2>

      <p>
The Ruby code that lives in a template is run within the context of an object
      of type <a href="rdoc/classes/ErbBinding.html">ErbBinding</a>.
      This class provides variables and methods that are useful within templates.
      </p>
      <p>
      Additionally, the BibOut package is mostly just a thin wrapper over another
      package which is called <a href="https://github.com/inukshuk/bibtex-ruby">bibtex-ruby</a>.  You'll need to know about several of the packages from <tt>bibtex-ruby</tt> in order
      to create your own templates.
      </p><p>
      The main two members that you need to know from the <code>ErbBinding</code> are:
      </p>
      <ul>
	<li><code>bib</code> : this variable contains the bibliography that is currently
	being processed.
	It is an object of type <a href="rdoc/classes/BibTeX/Bibliography.html">BibTeX::Bibliography</a>. This </li>
	<li><code><a href="rdoc/classes/ErbBinding.html#embed">embed</a></code> : this function allows you to call through to other template files within the current template.
	It also allows you to pass arguments into the sub-template.</li>
      </ul>
<p>
      Both of these are available within the binding that is used to evaluate your template.
      What this means is that you can just use the identifier <code>bib</code> within
      your template code, and it will work.
</p>
<p>
      There are also two classes that you need to know about,
      both of them inherited from the bibtex-ruby package.
      These are described in the next two sections.
</p>
      
<h3>Bibliography</h3>

<p>
The <code>bib</code> local variable is a variable of type <code>Bibliography</code>,
which is a bibtex-ruby class that contains all of the information in your bibliography.
One important thing that it lets you access all of the entries in the bibliography,
and search for particular entries of interest.
</p>
      
<p>
      The Bibliography object also contains a rich query language that allows you to access subset of the bibliography. For example,
</p>
  <pre>bib["@entry[year=1983]"]</pre>
<p>
returns a list of all entries in the bibliography whose year is 1983. If the year you
want lives in a variable called <code>y</code>, then you can just use Ruby string interpolation
syntax like this:
</p>
      <pre>bib["@entry[year=#{y}]"]</pre>
<p>
      For more examples, see the <a href="https://github.com/inukshuk/bibtex-ruby">bibtex-ruby readme</a>
and the <a href="http://rubydoc.info/gems/bibtex-ruby/BibTeX/Bibliography">documentation for the bibtex-ruby query function</a>.
</p>

<h3>Entry</h3>
<p>
Each entry that you retreive from a Bibliography object will be an object of type  <a href="rdoc/classes/BibTeX./Entry.html">BibTeX::Entry</a>. This is another class
from <tt>bibtex-ruby</tt>. This class will let you access the information
of each field within a BibTeX entry.
The methods of the Entry class that you will be most interested in are:
</p>
<ul>
  <li>The common required field types, such as <code>author</code>, <code>year</code>, and <code>title</code> have appropriate accessor methods. For less common fields,
  use a construct like <code>entry[:booktitle]</code> (assuming that <code>entry</code>
  names your object of type Entry)
  <li>The <code>author</code> function returns an object of type <code>Names</code>. This
  object has a method called <code>pretty</code> which returns a string that describes
  all of the authors of the publication, with commas and the word "and" inserted
  in the appropriate places.</li>
  <li><code>type</code> returns a Symbol that describes the type of the entry.</li>
  <li><code>key</code> returns a Symbol that gives key of the entry
</ul>

   <h1>Examples of Templates</h1>

<p>
Here are some examples to get you started.
</p>
      <ul>
	<li><a href="examples/simple-template.tmpl">simple-template.tmpl</a>.
	    A slightly expanded version of the template from the previous example.</li>
	<li><a href="examples/sutton-publications.tgz">sutton-publications.tgz</a>.
	    The template that I use for
	     <a href="http://homepages.inf.ed.ac.uk/csutton/publications.html">my publications page</a>.
	    I run this on a bib file that contains only my own papers.
	    This template features (a) the use of the <code>embed</code> function to include
	    one template in other, and (b) all of the publications are grouped by year,
	    with a special heading for each year.</li>
	    
	<li><a href="examples/navtbl.tgz">navtbl.tgz</a>. Outputs all publications as an HTML table,
	   with HTML links to the pdf files. 
	   I use a fancier version of this on my iPad, which lets me navigate
	   through the locally-stored PDFs of all of the papers that I would like to read.</li>	
      </ul>
      </div><!-- .span8 -->
 </div><!-- .row -->

 <div class="row">
   <div class="span12">
     <a href="XXXX">BibOut home page</a> &circ; <a href="http://github.com/casutton/bibout/">Fork on GitHub</a> &circ;
     <a href="http://homepages.inf.ed.ac.uk/csutton/">Charles Sutton</a>
   </div><!-- .span12 -->
 </div><!-- .row -->

 </div><!-- .container -->
     
 </body>
</html>